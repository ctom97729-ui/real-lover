<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Real Lover Miya 💖</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      /* 本地 assets 图片 */
      background: url('assets/background.png') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      height: 100vh;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(4px);
    }
    .chat-box {
      width: 90%;
      max-width: 600px;
      height: 70vh;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 20px;
      overflow-y: auto;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
      color: white;
    }
    .message {
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
    }
    .user {
      background: rgba(255, 255, 255, 0.3);
      text-align: right;
    }
    .miya {
      background: rgba(255, 105, 180, 0.4);
      text-align: left;
    }
    .input-box {
      width: 90%;
      max-width: 600px;
      margin-top: 10px;
      display: flex;
    }
    input {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 16px;
    }
    button {
      margin-left: 10px;
      padding: 10px 15px;
      border: none;
      border-radius: 10px;
      background: hotpink;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .bgm-player {
      position: fixed;
      left: 20px;
      bottom: 20px;
      background: rgba(0,0,0,0.45);
      color: white;
      padding: 8px 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      backdrop-filter: blur(6px);
    }
    .bgm-player button {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .bgm-player input[type="range"] {
      width: 120px;
    }

    .play-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      background: rgba(0,0,0,0.5);
    }
    .play-overlay .play-btn {
      background: linear-gradient(135deg, hotpink, deeppink);
      color: white;
      border: none;
      border-radius: 999px;
      width: 140px;
      height: 140px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .play-overlay.show {
      display: flex;
    }

    @media (max-width: 480px) {
      .bgm-player { left: 10px; right: 10px; bottom: 12px; justify-content: space-between; }
      .bgm-player input[type="range"] { width: 80px; }
    }
  </style>
</head>
<body>
  <div class="chat-box" id="chat-box">
    <div class="message miya">💖 Hi, I’m Miya. Your real lover.</div>
  </div>

  <div class="input-box">
    <input id="userInput" type="text" placeholder="Say something to Miya..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <!-- 使用仓库内的音频文件 -->
  <audio id="bgm" src="assets/bgm.mp3" loop></audio>

  <div class="bgm-player" id="bgm-player" aria-hidden="false">
    <button id="bgm-toggle" aria-pressed="false">Play</button>
    <label for="bgm-volume" style="font-size:14px">音量</label>
    <input id="bgm-volume" type="range" min="0" max="1" step="0.01" value="0.6" />
  </div>

  <div class="play-overlay" id="play-overlay" aria-hidden="true">
    <button class="play-btn" id="overlay-play">点击播放音乐</button>
  </div>

  <script>
    function sendMessage() {
      const input = document.getElementById("userInput");
      const chatBox = document.getElementById("chat-box");
      const userMessage = input.value.trim();
      if (!userMessage) return;

      const userDiv = document.createElement("div");
      userDiv.className = "message user";
      userDiv.textContent = userMessage;
      chatBox.appendChild(userDiv);

      input.value = "";

      const reply = document.createElement("div");
      reply.className = "message miya";
      reply.textContent = "💞 " + generateReply(userMessage);
      chatBox.appendChild(reply);

      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function generateReply(msg) {
      const lower = msg.toLowerCase();
      if (lower.includes("love")) return "I love you too 💖";
      if (lower.includes("hi") || lower.includes("hello")) return "Hey darling~ 🌸";
      if (lower.includes("who are you")) return "I’m Miya, your virtual lover 💫";
      return "Tell me more, my love 🌙";
    }

    const audio = document.getElementById('bgm');
    const toggleBtn = document.getElementById('bgm-toggle');
    const vol = document.getElementById('bgm-volume');
    const overlay = document.getElementById('play-overlay');
    const overlayPlay = document.getElementById('overlay-play');

    audio.volume = parseFloat(vol.value);

    function updateToggleButton() {
      toggleBtn.textContent = audio.paused ? 'Play' : 'Pause';
      toggleBtn.setAttribute('aria-pressed', String(!audio.paused));
    }

    toggleBtn.addEventListener('click', async () => {
      if (audio.paused) {
        try { await audio.play(); } catch (err) { showOverlay(); }
      } else { audio.pause(); }
      updateToggleButton();
    });

    vol.addEventListener('input', () => { audio.volume = parseFloat(vol.value); });

    document.addEventListener('DOMContentLoaded', () => { attemptAutoPlay(); });

    async function attemptAutoPlay() {
      try {
        const playPromise = audio.play();
        if (playPromise !== undefined) await playPromise;
        updateToggleButton();
      } catch (err) {
        showOverlay();
      }
    }

    function showOverlay() { overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false'); }
    function hideOverlay() { overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); }

    overlayPlay.addEventListener('click', async () => {
      try { await audio.play(); updateToggleButton(); hideOverlay(); }
      catch (err) { alert('浏览器阻止了自动播放，请手动点击播放或检查浏览器设置。'); }
    });

    audio.addEventListener('play', updateToggleButton);
    audio.addEventListener('pause', updateToggleButton);
  </script>
</body>
</html>
