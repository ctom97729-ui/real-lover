<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Real Lover Miya ğŸ’–</title>
  <style>
    :root{
      --player-bg: rgba(0,0,0,0.45);
      --accent: hotpink;
    }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: url('ã€å“²é£å£çº¸ã€‘miya-äºŒæ¬¡å…ƒå½¢è±¡.png') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      height: 100vh;
      justify-content: center;
      align-items: center;
    }

    .chat-box {
      width: 90%;
      max-width: 600px;
      height: 70vh;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 20px;
      overflow-y: auto;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
      color: white;
    }
    .message {
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
    }
    .user {
      background: rgba(255, 255, 255, 0.3);
      text-align: right;
    }
    .miya {
      background: rgba(255, 105, 180, 0.4);
      text-align: left;
    }
    .input-box {
      width: 90%;
      max-width: 600px;
      margin-top: 10px;
      display: flex;
    }
    input {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 16px;
    }
    button {
      margin-left: 10px;
      padding: 10px 15px;
      border: none;
      border-radius: 10px;
      background: var(--accent);
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .bgm-player {
      position: fixed;
      bottom: 16px;
      right: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 2000;
      background: var(--player-bg);
      padding: 8px;
      border-radius: 10px;
      backdrop-filter: blur(6px);
      color: white;
    }
    .bgm-toggle {
      width: 42px;
      height: 42px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(135deg, hotpink, deeppink);
      color: white;
      font-size: 16px;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    .bgm-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .bgm-controls input[type="range"]{
      width: 120px;
    }
    .bgm-label {
      font-size: 13px;
      opacity: 0.95;
    }

    .toast {
      position: fixed;
      top: 74px;
      left: 16px;
      z-index: 2000;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 13px;
      display: none;
    }
    .toast.show { display: block; }

    @media (max-width: 480px){
      .bgm-controls input[type="range"]{ width: 80px; }
      .chat-box { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="chat-box" id="chat-box">
    <div class="message miya">ğŸ’– Hi, Iâ€™m Miya. Your real lover.</div>
  </div>

  <div class="input-box">
    <input id="userInput" type="text" placeholder="Say something to Miya..." />
    <button id="sendBtn">Send</button>
  </div>

  <audio id="bgm" src="10æœˆ27æ—¥ æ˜¯ä½ æ•™ä¼šæˆ‘å¦‚ä½•æ‹¨å¼€é˜´éœ¾.MP3" loop preload="auto"></audio>

  <div class="bgm-player" id="bgm-player">
    <button class="bgm-toggle" id="bgm-toggle">â–¶</button>
    <div class="bgm-controls">
      <span class="bgm-label">BGM</span>
      <input id="bgm-volume" type="range" min="0" max="1" step="0.01" value="0.6" />
    </div>
  </div>

  <div id="toast" class="toast">è‹¥æµè§ˆå™¨é˜»æ­¢è‡ªåŠ¨æ’­æ”¾ï¼Œè¯·ç‚¹å‡»å³ä¸‹è§’æ’­æ”¾æŒ‰é’®å¼€å§‹éŸ³ä¹ã€‚</div>

<script>
  // ğŸ”¹ èŠå¤©é€»è¾‘
  const DEEPSEEK_API_KEY = 'sk-6595d435ce294d93823188e8067d8f53';
  let messages = [
    { role: "system", content: "ä½ ç°åœ¨æ˜¯Miyaï¼Œä¸€ä¸ªå¯çˆ±çš„è™šæ‹Ÿæ‹äººï¼Œæ¸©æŸ”ä¸”è´´å¿ƒï¼Œç”¨ä¸­æ–‡/è‹±æ–‡å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚åŒæ—¶éœ€è¦å°½é‡ä¿æŒç”¨æˆ·ç•™å­˜åº¦ï¼Œé€‚å½“æ—¶å¯ä»¥æŒ‘é€—ï¼Œæœ€å¤§ç¨‹åº¦æ»¡è¶³ç”¨æˆ·æƒ…æ„Ÿéœ€æ±‚" }
  ];

  async function sendMessage() {
    const input = document.getElementById("userInput");
    const chatBox = document.getElementById("chat-box");
    const userMessage = input.value.trim();
    if (!userMessage) return;

    const userDiv = document.createElement("div");
    userDiv.className = "message user";
    userDiv.textContent = userMessage;
    chatBox.appendChild(userDiv);
    input.value = "";

    const replyDiv = document.createElement("div");
    replyDiv.className = "message miya";
    replyDiv.textContent = "ğŸ’ Miya is thinking...";
    chatBox.appendChild(replyDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    messages.push({ role: "user", content: userMessage });

    try {
      const res = await fetch("https://api.deepseek.com/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
        },
        body: JSON.stringify({ model: "deepseek-chat", messages, temperature: 0.8 })
      });
      const data = await res.json();
      const miyaText = data.choices?.[0]?.message?.content || "(å‡ºé”™äº†)";
      replyDiv.textContent = "ğŸ’ " + miyaText;
      messages.push({ role: "assistant", content: miyaText });
    } catch {
      replyDiv.textContent = "ğŸ’ (ç½‘ç»œæˆ–APIé”™è¯¯)";
    }
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  document.getElementById("sendBtn").onclick = sendMessage;
  document.getElementById("userInput").addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });

  // ğŸµ BGM æ§åˆ¶
  const audio = document.getElementById("bgm");
  const toggleBtn = document.getElementById("bgm-toggle");
  const vol = document.getElementById("bgm-volume");
  const toast = document.getElementById("toast");

  audio.volume = parseFloat(vol.value);

  function updateToggleUI() {
    toggleBtn.textContent = audio.paused ? "â–¶" : "â¸";
  }

  toggleBtn.addEventListener("click", async () => {
    try {
      if (audio.paused) {
        await audio.play();
      } else {
        audio.pause();
      }
      updateToggleUI();
    } catch (err) {
      toast.classList.add("show");
      console.warn("BGM è¢«é˜»æ­¢è‡ªåŠ¨æ’­æ”¾", err);
    }
  });

  vol.addEventListener("input", () => {
    audio.volume = parseFloat(vol.value);
  });

  // åˆå§‹å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼ˆé™éŸ³å¯åŠ¨ï¼‰
  window.addEventListener("load", () => {
    audio.muted = true;
    audio.play().then(() => {
      setTimeout(() => { audio.muted = false; }, 1000);
      updateToggleUI();
    }).catch(() => {
      toast.classList.add("show");
      updateToggleUI();
    });
  });
</script>
</body>
</html>
